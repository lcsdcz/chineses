<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è°ƒè¯•é¡µé¢ - é«˜ä¸­è¯­æ–‡æ—©è¯»åŠ©æ‰‹</title>
    <style>
        body {
            font-family: 'Microsoft YaHei', sans-serif;
            margin: 20px;
            background: #f0f0f0;
        }
        .debug-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .debug-btn {
            background: #007bff;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        .debug-btn:hover {
            background: #0056b3;
        }
        .debug-btn.danger {
            background: #dc3545;
        }
        .debug-btn.danger:hover {
            background: #c82333;
        }
        .debug-btn.success {
            background: #28a745;
        }
        .debug-btn.success:hover {
            background: #218838;
        }
        .result {
            margin-top: 10px;
            padding: 10px;
            background: #e9ecef;
            border-radius: 5px;
            font-family: monospace;
            max-height: 300px;
            overflow-y: auto;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
        }
        .success {
            background: #d4edda;
            color: #155724;
        }
        .warning {
            background: #fff3cd;
            color: #856404;
        }
        .info {
            background: #d1ecf1;
            color: #0c5460;
        }
        .log-entry {
            margin: 5px 0;
            padding: 5px;
            border-left: 3px solid #007bff;
            background: #f8f9fa;
        }
        .log-error {
            border-left-color: #dc3545;
            background: #f8d7da;
        }
        .log-warning {
            border-left-color: #ffc107;
            background: #fff3cd;
        }
        .performance-bar {
            background: #e9ecef;
            height: 20px;
            border-radius: 10px;
            overflow: hidden;
            margin: 5px 0;
        }
        .performance-fill {
            background: #28a745;
            height: 100%;
            transition: width 0.3s ease;
        }
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin: 10px 0;
        }
        .data-table th, .data-table td {
            border: 1px solid #dee2e6;
            padding: 8px;
            text-align: left;
        }
        .data-table th {
            background: #f8f9fa;
            font-weight: bold;
        }
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        .status-ok { background: #28a745; }
        .status-error { background: #dc3545; }
        .status-warning { background: #ffc107; }
        .status-info { background: #17a2b8; }
    </style>
</head>
<body>
    <h1>ğŸ” é«˜ä¸­è¯­æ–‡æ—©è¯»åŠ©æ‰‹ - è°ƒè¯•é¡µé¢</h1>
    
    <div class="debug-section">
        <h2>ğŸ“‹ æ–‡ä»¶æ£€æŸ¥</h2>
        <button class="debug-btn" onclick="checkFiles()">æ£€æŸ¥æ–‡ä»¶</button>
        <button class="debug-btn" onclick="checkDependencies()">æ£€æŸ¥ä¾èµ–</button>
        <div id="fileResult" class="result"></div>
    </div>
    
    <div class="debug-section">
        <h2>ğŸ”§ JavaScriptåŠŸèƒ½æµ‹è¯•</h2>
        <button class="debug-btn" onclick="testJavaScript()">æµ‹è¯•JavaScript</button>
        <button class="debug-btn" onclick="testFunctions()">æµ‹è¯•å‡½æ•°</button>
        <button class="debug-btn" onclick="testDatabase()">æµ‹è¯•æ•°æ®åº“</button>
        <button class="debug-btn" onclick="testPerformance()">æ€§èƒ½æµ‹è¯•</button>
        <div id="jsResult" class="result"></div>
    </div>
    
    <div class="debug-section">
        <h2>ğŸ¯ æ¨¡å¼é€‰æ‹©æµ‹è¯•</h2>
        <button class="debug-btn" onclick="testModeSelection()">æµ‹è¯•æ¨¡å¼é€‰æ‹©</button>
        <button class="debug-btn" onclick="testChapterSelection()">æµ‹è¯•ç« èŠ‚é€‰æ‹©</button>
        <button class="debug-btn" onclick="testPoemSelection()">æµ‹è¯•è¯—æ–‡é€‰æ‹©</button>
        <div id="modeResult" class="result"></div>
    </div>
    
    <div class="debug-section">
        <h2>ğŸ“š æ•°æ®åº“å†…å®¹</h2>
        <button class="debug-btn" onclick="showDatabase()">æ˜¾ç¤ºæ•°æ®åº“</button>
        <button class="debug-btn" onclick="validateDatabase()">éªŒè¯æ•°æ®å®Œæ•´æ€§</button>
        <button class="debug-btn" onclick="exportDatabase()">å¯¼å‡ºæ•°æ®</button>
        <div id="dbResult" class="result"></div>
    </div>

    <div class="debug-section">
        <h2>ğŸš€ æ€§èƒ½ç›‘æ§</h2>
        <button class="debug-btn" onclick="startPerformanceMonitoring()">å¼€å§‹ç›‘æ§</button>
        <button class="debug-btn" onclick="stopPerformanceMonitoring()">åœæ­¢ç›‘æ§</button>
        <button class="debug-btn" onclick="clearPerformanceData()">æ¸…é™¤æ•°æ®</button>
        <div id="performanceResult" class="result"></div>
    </div>

    <div class="debug-section">
        <h2>ğŸ“ é”™è¯¯æ—¥å¿—</h2>
        <button class="debug-btn" onclick="showErrorLog()">æ˜¾ç¤ºé”™è¯¯æ—¥å¿—</button>
        <button class="debug-btn" onclick="clearErrorLog()">æ¸…é™¤æ—¥å¿—</button>
        <button class="debug-btn" onclick="exportErrorLog()">å¯¼å‡ºæ—¥å¿—</button>
        <div id="errorLogResult" class="result"></div>
    </div>

    <div class="debug-section">
        <h2>ğŸ§ª å‹åŠ›æµ‹è¯•</h2>
        <button class="debug-btn" onclick="runStressTest()">è¿è¡Œå‹åŠ›æµ‹è¯•</button>
        <button class="debug-btn" onclick="testMemoryUsage()">æµ‹è¯•å†…å­˜ä½¿ç”¨</button>
        <button class="debug-btn danger" onclick="clearAllData()">æ¸…é™¤æ‰€æœ‰æ•°æ®</button>
        <div id="stressTestResult" class="result"></div>
    </div>

    <script src="script.js"></script>
    <script>
        // å…¨å±€å˜é‡
        let performanceData = [];
        let errorLog = [];
        let performanceMonitoring = false;
        let performanceInterval;

        // é”™è¯¯æ—¥å¿—è®°å½•å™¨
        window.addEventListener('error', function(e) {
            const errorEntry = {
                timestamp: new Date().toISOString(),
                message: e.message,
                filename: e.filename,
                lineno: e.lineno,
                colno: e.colno,
                stack: e.error ? e.error.stack : 'æ— å †æ ˆä¿¡æ¯'
            };
            errorLog.push(errorEntry);
            console.error('é”™è¯¯å·²è®°å½•:', errorEntry);
        });

        // æ€§èƒ½ç›‘æ§
        function startPerformanceMonitoring() {
            if (performanceMonitoring) return;
            
            performanceMonitoring = true;
            performanceData = [];
            performanceInterval = setInterval(() => {
                const memory = performance.memory;
                const timing = performance.timing;
                
                performanceData.push({
                    timestamp: Date.now(),
                    memory: {
                        used: memory ? memory.usedJSHeapSize : 0,
                        total: memory ? memory.totalJSHeapSize : 0,
                        limit: memory ? memory.jsHeapSizeLimit : 0
                    },
                    timing: {
                        loadTime: timing ? timing.loadEventEnd - timing.navigationStart : 0,
                        domReady: timing ? timing.domContentLoadedEventEnd - timing.navigationStart : 0
                    }
                });
                
                updatePerformanceDisplay();
            }, 1000);
            
            document.getElementById('performanceResult').innerHTML = '<div class="success">âœ… æ€§èƒ½ç›‘æ§å·²å¼€å§‹</div>';
        }

        function stopPerformanceMonitoring() {
            if (!performanceMonitoring) return;
            
            performanceMonitoring = false;
            clearInterval(performanceInterval);
            document.getElementById('performanceResult').innerHTML = '<div class="warning">âš ï¸ æ€§èƒ½ç›‘æ§å·²åœæ­¢</div>';
        }

        function clearPerformanceData() {
            performanceData = [];
            document.getElementById('performanceResult').innerHTML = '<div class="info">â„¹ï¸ æ€§èƒ½æ•°æ®å·²æ¸…é™¤</div>';
        }

        function updatePerformanceDisplay() {
            if (performanceData.length === 0) return;
            
            const latest = performanceData[performanceData.length - 1];
            const memory = latest.memory;
            const memoryUsage = memory.total > 0 ? (memory.used / memory.total * 100).toFixed(1) : 0;
            
            let html = '<div class="info">ğŸ“Š å®æ—¶æ€§èƒ½æ•°æ®:</div>';
            html += `<div>å†…å­˜ä½¿ç”¨: ${(memory.used / 1024 / 1024).toFixed(2)} MB / ${(memory.total / 1024 / 1024).toFixed(2)} MB</div>`;
            html += `<div class="performance-bar"><div class="performance-fill" style="width: ${memoryUsage}%"></div></div>`;
            html += `<div>ä½¿ç”¨ç‡: ${memoryUsage}%</div>`;
            html += `<div>æ•°æ®ç‚¹æ•°é‡: ${performanceData.length}</div>`;
            
            document.getElementById('performanceResult').innerHTML = html;
        }

        function checkFiles() {
            const result = document.getElementById('fileResult');
            try {
                // æ£€æŸ¥å¿…è¦çš„å…ƒç´ æ˜¯å¦å­˜åœ¨
                const modeSelection = document.getElementById('mode-selection');
                const chapterSelection = document.getElementById('chapterSelection');
                
                if (modeSelection && chapterSelection) {
                    result.innerHTML = '<div class="success">âœ… HTMLå…ƒç´ æ£€æŸ¥é€šè¿‡</div>';
                } else {
                    result.innerHTML = '<div class="error">âŒ HTMLå…ƒç´ ç¼ºå¤±</div>';
                }
            } catch (error) {
                result.innerHTML = `<div class="error">âŒ é”™è¯¯: ${error.message}</div>`;
            }
        }

        function checkDependencies() {
            const result = document.getElementById('fileResult');
            const dependencies = [
                { name: 'script.js', check: () => typeof window.currentMode !== 'undefined' },
                { name: 'poems-data.js', check: () => typeof window.poemDatabase !== 'undefined' },
                { name: 'styles.css', check: () => document.querySelector('link[href*="styles.css"]') !== null }
            ];
            
            let html = '<div class="info">ğŸ“¦ ä¾èµ–æ£€æŸ¥ç»“æœ:</div>';
            dependencies.forEach(dep => {
                try {
                    const status = dep.check();
                    const statusClass = status ? 'success' : 'error';
                    const statusIcon = status ? 'âœ…' : 'âŒ';
                    html += `<div class="${statusClass}">${statusIcon} ${dep.name}: ${status ? 'å·²åŠ è½½' : 'æœªåŠ è½½'}</div>`;
                } catch (error) {
                    html += `<div class="error">âŒ ${dep.name}: æ£€æŸ¥å¤±è´¥ - ${error.message}</div>`;
                }
            });
            
            result.innerHTML = html;
        }
        
        function testJavaScript() {
            const result = document.getElementById('jsResult');
            try {
                if (typeof poemDatabase !== 'undefined') {
                    result.innerHTML = '<div class="success">âœ… poemDatabase å·²å®šä¹‰</div>';
                } else {
                    result.innerHTML = '<div class="error">âŒ poemDatabase æœªå®šä¹‰</div>';
                }
            } catch (error) {
                result.innerHTML = `<div class="error">âŒ é”™è¯¯: ${error.message}</div>`;
            }
        }
        
        function testFunctions() {
            const result = document.getElementById('jsResult');
            const functions = ['setMode', 'selectChapter', 'displayPoemList', 'selectPoem'];
            let missingFunctions = [];
            
            functions.forEach(func => {
                if (typeof window[func] !== 'function') {
                    missingFunctions.push(func);
                }
            });
            
            if (missingFunctions.length === 0) {
                result.innerHTML = '<div class="success">âœ… æ‰€æœ‰å‡½æ•°éƒ½å­˜åœ¨</div>';
            } else {
                result.innerHTML = `<div class="error">âŒ ç¼ºå¤±å‡½æ•°: ${missingFunctions.join(', ')}</div>`;
            }
        }
        
        function testDatabase() {
            const result = document.getElementById('jsResult');
            try {
                if (typeof poemDatabase !== 'undefined') {
                    const chapters = Object.keys(poemDatabase);
                    let totalPoems = 0;
                    let totalExercises = 0;
                    
                    chapters.forEach(chapter => {
                        totalPoems += poemDatabase[chapter].length;
                        poemDatabase[chapter].forEach(poem => {
                            if (poem.exercises) {
                                totalExercises += poem.exercises.length;
                            }
                        });
                    });
                    
                    result.innerHTML = `
                        <div class="success">
                            âœ… æ•°æ®åº“æ­£å¸¸<br>
                            ç« èŠ‚æ•°: ${chapters.length}<br>
                            æ€»è¯—æ–‡æ•°: ${totalPoems}<br>
                            æ€»ç»ƒä¹ æ•°: ${totalExercises}
                        </div>
                    `;
                } else {
                    result.innerHTML = '<div class="error">âŒ æ•°æ®åº“æœªå®šä¹‰</div>';
                }
            } catch (error) {
                result.innerHTML = `<div class="error">âŒ é”™è¯¯: ${error.message}</div>`;
            }
        }

        function testPerformance() {
            const result = document.getElementById('jsResult');
            const startTime = performance.now();
            
            // æ¨¡æ‹Ÿä¸€äº›æ“ä½œ
            let testData = [];
            for (let i = 0; i < 1000; i++) {
                testData.push({ id: i, value: Math.random() });
            }
            
            const endTime = performance.now();
            const duration = endTime - startTime;
            
            let performanceRating = 'ä¼˜ç§€';
            if (duration > 100) performanceRating = 'è‰¯å¥½';
            if (duration > 500) performanceRating = 'ä¸€èˆ¬';
            if (duration > 1000) performanceRating = 'è¾ƒå·®';
            
            result.innerHTML = `
                <div class="info">
                    âš¡ æ€§èƒ½æµ‹è¯•ç»“æœ:<br>
                    æµ‹è¯•è€—æ—¶: ${duration.toFixed(2)}ms<br>
                    æ€§èƒ½è¯„çº§: ${performanceRating}<br>
                    æµ‹è¯•æ•°æ®é‡: ${testData.length}
                </div>
            `;
        }
        
        function testModeSelection() {
            const result = document.getElementById('modeResult');
            try {
                if (typeof setMode === 'function') {
                    // å°è¯•è°ƒç”¨å‡½æ•°
                    setMode('test');
                    result.innerHTML = '<div class="success">âœ… setModeå‡½æ•°å¯ä»¥è°ƒç”¨</div>';
                } else {
                    result.innerHTML = '<div class="error">âŒ setModeå‡½æ•°ä¸å­˜åœ¨</div>';
                }
            } catch (error) {
                result.innerHTML = `<div class="error">âŒ é”™è¯¯: ${error.message}</div>`;
            }
        }

        function testChapterSelection() {
            const result = document.getElementById('modeResult');
            try {
                if (typeof selectChapter === 'function') {
                    // æ£€æŸ¥æ˜¯å¦æœ‰å¯ç”¨çš„ç« èŠ‚
                    if (typeof poemDatabase !== 'undefined' && Object.keys(poemDatabase).length > 0) {
                        const firstChapter = Object.keys(poemDatabase)[0];
                        selectChapter(firstChapter);
                        result.innerHTML = `<div class="success">âœ… selectChapterå‡½æ•°å¯ä»¥è°ƒç”¨ï¼Œå·²é€‰æ‹©ç« èŠ‚: ${firstChapter}</div>`;
                    } else {
                        result.innerHTML = '<div class="warning">âš ï¸ selectChapterå‡½æ•°å­˜åœ¨ï¼Œä½†æ•°æ®åº“ä¸ºç©º</div>';
                    }
                } else {
                    result.innerHTML = '<div class="error">âŒ selectChapterå‡½æ•°ä¸å­˜åœ¨</div>';
                }
            } catch (error) {
                result.innerHTML = `<div class="error">âŒ é”™è¯¯: ${error.message}</div>`;
            }
        }

        function testPoemSelection() {
            const result = document.getElementById('modeResult');
            try {
                if (typeof selectPoem === 'function' && poems && poems.length > 0) {
                    selectPoem(0);
                    result.innerHTML = `<div class="success">âœ… selectPoemå‡½æ•°å¯ä»¥è°ƒç”¨ï¼Œå·²é€‰æ‹©è¯—æ–‡: ${poems[0].title}</div>`;
                } else if (typeof selectPoem === 'function') {
                    result.innerHTML = '<div class="warning">âš ï¸ selectPoemå‡½æ•°å­˜åœ¨ï¼Œä½†æ²¡æœ‰å¯ç”¨çš„è¯—æ–‡</div>';
                } else {
                    result.innerHTML = '<div class="error">âŒ selectPoemå‡½æ•°ä¸å­˜åœ¨</div>';
                }
            } catch (error) {
                result.innerHTML = `<div class="error">âŒ é”™è¯¯: ${error.message}</div>`;
            }
        }
        
        function showDatabase() {
            const result = document.getElementById('dbResult');
            try {
                if (typeof poemDatabase !== 'undefined') {
                    let html = '<strong>ğŸ“š æ•°æ®åº“å†…å®¹:</strong><br><br>';
                    Object.keys(poemDatabase).forEach(chapter => {
                        html += `<strong>${chapter}:</strong><br>`;
                        poemDatabase[chapter].forEach(poem => {
                            const exerciseCount = poem.exercises ? poem.exercises.length : 0;
                            html += `- ${poem.title} (${poem.author}) - ${exerciseCount}ç§ç»ƒä¹ <br>`;
                        });
                        html += '<br>';
                    });
                    result.innerHTML = html;
                } else {
                    result.innerHTML = '<div class="error">âŒ æ•°æ®åº“æœªå®šä¹‰</div>';
                }
            } catch (error) {
                result.innerHTML = `<div class="error">âŒ é”™è¯¯: ${error.message}</div>`;
            }
        }

        function validateDatabase() {
            const result = document.getElementById('dbResult');
            try {
                if (typeof poemDatabase !== 'undefined') {
                    let issues = [];
                    let totalPoems = 0;
                    let totalExercises = 0;
                    
                    Object.keys(poemDatabase).forEach(chapter => {
                        poemDatabase[chapter].forEach((poem, index) => {
                            totalPoems++;
                            
                            // æ£€æŸ¥å¿…è¦å­—æ®µ
                            if (!poem.title) issues.push(`${chapter}[${index}]: ç¼ºå°‘æ ‡é¢˜`);
                            if (!poem.author) issues.push(`${chapter}[${index}]: ç¼ºå°‘ä½œè€…`);
                            if (!poem.content) issues.push(`${chapter}[${index}]: ç¼ºå°‘å†…å®¹`);
                            
                            // æ£€æŸ¥ç»ƒä¹ é…ç½®
                            if (poem.exercises) {
                                totalExercises += poem.exercises.length;
                                poem.exercises.forEach((exercise, exIndex) => {
                                    if (!exercise.type) issues.push(`${chapter}[${index}].exercises[${exIndex}]: ç¼ºå°‘ç»ƒä¹ ç±»å‹`);
                                    if (!exercise.title) issues.push(`${chapter}[${index}].exercises[${exIndex}]: ç¼ºå°‘ç»ƒä¹ æ ‡é¢˜`);
                                });
                            }
                        });
                    });
                    
                    if (issues.length === 0) {
                        result.innerHTML = `
                            <div class="success">
                                âœ… æ•°æ®éªŒè¯é€šè¿‡<br>
                                æ€»è¯—æ–‡æ•°: ${totalPoems}<br>
                                æ€»ç»ƒä¹ æ•°: ${totalExercises}
                            </div>
                        `;
                    } else {
                        result.innerHTML = `
                            <div class="warning">
                                âš ï¸ å‘ç° ${issues.length} ä¸ªé—®é¢˜:<br>
                                ${issues.join('<br>')}
                            </div>
                        `;
                    }
                } else {
                    result.innerHTML = '<div class="error">âŒ æ•°æ®åº“æœªå®šä¹‰</div>';
                }
            } catch (error) {
                result.innerHTML = `<div class="error">âŒ é”™è¯¯: ${error.message}</div>`;
            }
        }

        function exportDatabase() {
            try {
                if (typeof poemDatabase !== 'undefined') {
                    const dataStr = JSON.stringify(poemDatabase, null, 2);
                    const dataBlob = new Blob([dataStr], { type: 'application/json' });
                    const url = URL.createObjectURL(dataBlob);
                    const link = document.createElement('a');
                    link.href = url;
                    link.download = 'poem-database.json';
                    link.click();
                    URL.revokeObjectURL(url);
                    
                    document.getElementById('dbResult').innerHTML = '<div class="success">âœ… æ•°æ®åº“å·²å¯¼å‡º</div>';
                } else {
                    document.getElementById('dbResult').innerHTML = '<div class="error">âŒ æ•°æ®åº“æœªå®šä¹‰</div>';
                }
            } catch (error) {
                document.getElementById('dbResult').innerHTML = `<div class="error">âŒ å¯¼å‡ºå¤±è´¥: ${error.message}</div>`;
            }
        }

        function showErrorLog() {
            const result = document.getElementById('errorLogResult');
            if (errorLog.length === 0) {
                result.innerHTML = '<div class="info">â„¹ï¸ æš‚æ— é”™è¯¯æ—¥å¿—</div>';
                return;
            }
            
            let html = '<div class="info">ğŸ“ é”™è¯¯æ—¥å¿— (å…±' + errorLog.length + 'æ¡):</div>';
            errorLog.forEach((entry, index) => {
                const logClass = entry.message.includes('Error') ? 'log-error' : 'log-warning';
                html += `
                    <div class="log-entry ${logClass}">
                        <strong>${entry.timestamp}</strong><br>
                        æ¶ˆæ¯: ${entry.message}<br>
                        æ–‡ä»¶: ${entry.filename}:${entry.lineno}:${entry.colno}<br>
                        å †æ ˆ: ${entry.stack.substring(0, 200)}...
                    </div>
                `;
            });
            
            result.innerHTML = html;
        }

        function clearErrorLog() {
            errorLog = [];
            document.getElementById('errorLogResult').innerHTML = '<div class="info">â„¹ï¸ é”™è¯¯æ—¥å¿—å·²æ¸…é™¤</div>';
        }

        function exportErrorLog() {
            try {
                const dataStr = JSON.stringify(errorLog, null, 2);
                const dataBlob = new Blob([dataStr], { type: 'application/json' });
                const url = URL.createObjectURL(dataBlob);
                const link = document.createElement('a');
                link.href = url;
                link.download = 'error-log.json';
                link.click();
                URL.revokeObjectURL(url);
                
                document.getElementById('errorLogResult').innerHTML = '<div class="success">âœ… é”™è¯¯æ—¥å¿—å·²å¯¼å‡º</div>';
            } catch (error) {
                document.getElementById('errorLogResult').innerHTML = `<div class="error">âŒ å¯¼å‡ºå¤±è´¥: ${error.message}</div>`;
            }
        }

        function runStressTest() {
            const result = document.getElementById('stressTestResult');
            const startTime = performance.now();
            let operations = 0;
            
            // æ¨¡æ‹Ÿå¤§é‡æ“ä½œ
            const testInterval = setInterval(() => {
                try {
                    // æ¨¡æ‹Ÿå„ç§æ“ä½œ
                    if (typeof setMode === 'function') setMode('test');
                    if (typeof selectChapter === 'function' && typeof poemDatabase !== 'undefined') {
                        const chapters = Object.keys(poemDatabase);
                        if (chapters.length > 0) {
                            selectChapter(chapters[0]);
                        }
                    }
                    
                    operations++;
                    
                    if (operations >= 100) {
                        clearInterval(testInterval);
                        const endTime = performance.now();
                        const duration = endTime - startTime;
                        
                        result.innerHTML = `
                            <div class="success">
                                âœ… å‹åŠ›æµ‹è¯•å®Œæˆ<br>
                                æ‰§è¡Œæ“ä½œæ•°: ${operations}<br>
                                æ€»è€—æ—¶: ${duration.toFixed(2)}ms<br>
                                å¹³å‡è€—æ—¶: ${(duration / operations).toFixed(2)}ms/æ“ä½œ
                            </div>
                        `;
                    }
                } catch (error) {
                    clearInterval(testInterval);
                    result.innerHTML = `<div class="error">âŒ å‹åŠ›æµ‹è¯•å¤±è´¥: ${error.message}</div>`;
                }
            }, 10);
        }

        function testMemoryUsage() {
            const result = document.getElementById('stressTestResult');
            try {
                if (performance.memory) {
                    const memory = performance.memory;
                    const usedMB = (memory.usedJSHeapSize / 1024 / 1024).toFixed(2);
                    const totalMB = (memory.totalJSHeapSize / 1024 / 1024).toFixed(2);
                    const limitMB = (memory.jsHeapSizeLimit / 1024 / 1024).toFixed(2);
                    const usagePercent = (memory.usedJSHeapSize / memory.totalJSHeapSize * 100).toFixed(1);
                    
                    result.innerHTML = `
                        <div class="info">
                            ğŸ’¾ å†…å­˜ä½¿ç”¨æƒ…å†µ:<br>
                            å·²ä½¿ç”¨: ${usedMB} MB<br>
                            æ€»åˆ†é…: ${totalMB} MB<br>
                            é™åˆ¶: ${limitMB} MB<br>
                            ä½¿ç”¨ç‡: ${usagePercent}%
                        </div>
                    `;
                } else {
                    result.innerHTML = '<div class="warning">âš ï¸ æ— æ³•è·å–å†…å­˜ä¿¡æ¯</div>';
                }
            } catch (error) {
                result.innerHTML = `<div class="error">âŒ å†…å­˜æµ‹è¯•å¤±è´¥: ${error.message}</div>`;
            }
        }

        function clearAllData() {
            if (confirm('ç¡®å®šè¦æ¸…é™¤æ‰€æœ‰æ•°æ®å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ï¼')) {
                try {
                    // æ¸…é™¤å„ç§æ•°æ®
                    if (typeof localStorage !== 'undefined') {
                        localStorage.clear();
                    }
                    if (typeof sessionStorage !== 'undefined') {
                        sessionStorage.clear();
                    }
                    
                    // é‡ç½®å…¨å±€å˜é‡
                    if (typeof window.currentMode !== 'undefined') window.currentMode = '';
                    if (typeof window.currentChapter !== 'undefined') window.currentChapter = '';
                    if (typeof window.currentPoemIndex !== 'undefined') window.currentPoemIndex = 0;
                    
                    // æ¸…é™¤æµ‹è¯•æ•°æ®
                    performanceData = [];
                    errorLog = [];
                    
                    // åœæ­¢æ€§èƒ½ç›‘æ§
                    if (performanceMonitoring) {
                        stopPerformanceMonitoring();
                    }
                    
                    document.getElementById('stressTestResult').innerHTML = '<div class="success">âœ… æ‰€æœ‰æ•°æ®å·²æ¸…é™¤</div>';
                } catch (error) {
                    document.getElementById('stressTestResult').innerHTML = `<div class="error">âŒ æ¸…é™¤å¤±è´¥: ${error.message}</div>`;
                }
            }
        }
        
        // é¡µé¢åŠ è½½å®Œæˆåè‡ªåŠ¨æ£€æŸ¥
        window.onload = function() {
            setTimeout(() => {
                checkFiles();
                checkDependencies();
                testJavaScript();
                console.log('è°ƒè¯•é¡µé¢å·²åŠ è½½å®Œæˆ');
            }, 500);
        };
    </script>
</body>
</html>
